--- origsrc/datefudge-1.17/datefudge.c	2011-06-23 12:40:06.000000000 -0500
+++ src/datefudge-1.17/datefudge.c	2011-12-28 20:42:45.527001000 -0600
@@ -19,6 +19,11 @@
 #include <time.h>
 #include <sys/time.h>
 
+#ifdef __CYGWIN__
+#include <sys/cygwin.h>
+#define RTLD_NEXT dlopen("cygwin1.dll", RTLD_LAZY)
+#endif
+
 static int fudge = 0;
 static int dostatic = 0;
 
@@ -64,8 +69,8 @@ time_t time(time_t *x) {
     return res;
 }
 
-int __gettimeofday(struct timeval *x, struct timezone *y) {
-    static int (*libc_gettimeofday)(struct timeval *, struct timezone *) = NULL;
+int gettimeofday(struct timeval *x, void *y) {
+    static int (*libc_gettimeofday)(struct timeval *, void *) = NULL;
     int res;
 
     if(!libc_gettimeofday)
@@ -76,10 +81,6 @@ int __gettimeofday(struct timeval *x, st
     return 0;
 }
 
-int gettimeofday(struct timeval *x, struct timezone *y) { 
-    return __gettimeofday(x,y); 
-}
-
 #ifndef __GNU__
 
 int clock_gettime(clockid_t x, struct timespec *y) {
@@ -95,3 +96,15 @@ int clock_gettime(clockid_t x, struct ti
 }
 
 #endif
+
+#ifdef __CYGWIN__
+
+__attribute__((constructor))
+void _init (void)
+{
+  cygwin_internal (CW_HOOK, "time", time);
+  cygwin_internal (CW_HOOK, "gettimeofday", gettimeofday);
+  cygwin_internal (CW_HOOK, "clock_gettime", clock_gettime);
+}
+
+#endif
